<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title></title>
</head>
<body>
  <button id="no-websocket">Connect to websocket and start</button>
  <h2>XOR Results</h2>
  <ul id="xor-results"></ul>
  <script type="text/javascript">
    var webSocketConnected = false, webSocketInstance = null
    const onopen = () => {
      webSocketConnected = true
      $('#no-websocket').hide()
    }
    const onmessage = (event) => {
      try {
        const parsedData = JSON.parse(event.data)
        if (parsedData.msg == 'who are you') {
          webSocketInstance.send(JSON.stringify({ msg: 'game', game: 'xor' }))
          return
        }
      } catch(e) {}
    }

    // XOR rounds with expected result
    const game_rounds = [
      [[0, 0], 0],
      [[0, 1], 1],
      [[1, 0], 1],
      [[1, 1], 0],
    ]

    const removeWebSocketListeners = () => {
      $('#no-websocket').show()
      webSocketConnected = false
      webSocketInstance.removeEventListener('open', onopen)
      webSocketInstance.removeEventListener('message', onmessage)
      webSocketInstance.removeEventListener('error', removeWebSocketListeners)
      webSocketInstance.removeEventListener('close', removeWebSocketListeners)
      webSocketInstance = null
    }

    const addWebSocketListeners = () => {
      if (webSocketInstance !== null) return
      const url = 'ws://localhost:'+WEBSOCKET_PORT
      console.log('trying to connect to websocket: '+url)
      webSocketInstance = new WebSocket(url)
      webSocketInstance.addEventListener('open', onopen)
      webSocketInstance.addEventListener('message', onmessage)
      webSocketInstance.addEventListener('error', removeWebSocketListeners)
      webSocketInstance.addEventListener('close', removeWebSocketListeners)
    }
  </script>
</body>
</html>